---
- ansible.builtin.assert:
    that:
      - item is defined
      - item.name is defined
      - item.name != ""
      - item.src is defined
      - item.src != ""
      - item.dest is defined
      - item.dest != ""
    quiet: true

- name: "Ensures script job for {{ item.name }} is deployed"
  ansible.builtin.template:
    src: "{{ item.src }}"
    dest: "{{ item.dest }}"
    owner: root
    group: root
    mode: 0745

- name: "Ensures cron task for {{ item.name }} is defined."
  ansible.builtin.cron:
    name: "{{ item.name }}"
    job: "{{ item.dest }}"
    special_time: "{{ item.special_time }}"
  when:
    - item.special_time is defined

- name: "Ensures cron task for {{ item.name }} is defined."
  ansible.builtin.cron:
    name: "{{ item.name }}"
    job: "{{ item.dest }}"
    weekday: "{{ item.weekday | default(omit) }}"
    minute: "{{ item.minute | default(omit) }}"
    hour: "{{ item.hour | default(omit) }}"
    day: "{{ item.day | default(omit) }}"
  when:
    - not item.special_time is defined
